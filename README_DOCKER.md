# üê≥ Docker –¥–ª—è Gemini-API

–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É Gemini-API –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker 20.10+
- Docker Compose 2.0+
- –ê–∫–∫–∞—É–Ω—Ç Google —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ [gemini.google.com](https://gemini.google.com)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ cookies

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://gemini.google.com –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –ø–æ–¥ —Å–≤–æ–∏–º Google –∞–∫–∫–∞—É–Ω—Ç–æ–º
3. –ù–∞–∂–º–∏—Ç–µ **F12** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Network**
4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (**F5**)
5. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª—é–±–æ–π –∑–∞–ø—Ä–æ—Å
6. –í **Headers** ‚Üí **Request Headers** ‚Üí **Cookie** –Ω–∞–π–¥–∏—Ç–µ:
   - `__Secure-1PSID` 
   - `__Secure-1PSIDTS`

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ cookies
nano .env
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `.env`:**
```bash
GEMINI_PSID=–≤–∞—à_secure_1psid_–∑–¥–µ—Å—å
GEMINI_PSIDTS=–≤–∞—à_secure_1psidts_–∑–¥–µ—Å—å
MODE=cli
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫

#### CLI —Ä–µ–∂–∏–º (–æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å)
```bash
docker-compose up
```

#### API —Ä–µ–∂–∏–º (HTTP —Å–µ—Ä–≤–µ—Ä)
```bash
# –ò–∑–º–µ–Ω–∏—Ç–µ MODE=api –≤ .env
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:8000/health
```

---

## üîß –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ CLI Mode (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

–ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Gemini.

**–ó–∞–ø—É—Å–∫:**
```bash
docker-compose run --rm gemini-api
```

**–í—ã–≤–æ–¥:**
```
‚úÖ Gemini –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!
üì§ –ó–∞–ø—Ä–æ—Å: –ü—Ä–∏–≤–µ—Ç! –†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤...
üì• –û—Ç–≤–µ—Ç: <–æ—Ç–≤–µ—Ç –æ—Ç Gemini>
```

### 2Ô∏è‚É£ API Mode (FastAPI —Å–µ—Ä–≤–µ—Ä)

HTTP API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ REST.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
```bash
# –í .env
MODE=api
API_PORT=8000
```

**–ó–∞–ø—É—Å–∫:**
```bash
docker-compose up -d
```

**Endpoints:**

#### POST `/ask` ‚Äî –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
```bash
curl -X POST http://localhost:8000/ask \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "–†–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º",
    "model": "gemini-2.5-flash"
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "text": "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –∑–∞–±—ã–ª –∑–∞–∫—Ä—ã—Ç—å —Å–∫–æ–±–∫—É...",
  "thoughts": null,
  "images": [],
  "metadata": ["chat_id", "reply_id", "candidate_id"]
}
```

#### GET `/health` ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
curl http://localhost:8000/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "message": "Gemini API —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ"
}
```

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `GEMINI_PSID` | Cookie `__Secure-1PSID` | **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** |
| `GEMINI_PSIDTS` | Cookie `__Secure-1PSIDTS` | - |
| `GEMINI_PROXY` | –ü—Ä–æ–∫—Å–∏ (http://ip:port) | - |
| `MODE` | –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (cli/api) | `cli` |
| `API_PORT` | –ü–æ—Ä—Ç API —Å–µ—Ä–≤–µ—Ä–∞ | `8000` |
| `GEMINI_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (—Å–µ–∫) | `30` |
| `GEMINI_AUTO_REFRESH` | –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies | `true` |
| `GEMINI_REFRESH_INTERVAL` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–µ–∫) | `540` |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ | `INFO` |

---

## üíæ –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å cookies

Cookies –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `./cookies/` –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
Gemini-API/
‚îú‚îÄ‚îÄ cookies/
‚îÇ   ‚îî‚îÄ‚îÄ .cached_1psidts_<PSID>.txt   # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è
‚îî‚îÄ‚îÄ .env
```

**–û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞:**
```bash
rm -rf ./cookies/*
```

---

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å (CLI)

```bash
docker-compose run --rm gemini-api
```

### –ü—Ä–∏–º–µ—Ä 2: API –∑–∞–ø—Ä–æ—Å —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

```bash
curl -X POST http://localhost:8000/ask \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∫–∞—Ä—Ç–∏–Ω–∫—É —Å –∫–æ—Ç–∏–∫–æ–º –≤ –∫–æ—Å–º–æ—Å–µ"
  }'
```

**–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç URLs –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
```json
{
  "text": "–í–æ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∞ –∫–æ—Ç–∏–∫–∞ –≤ –∫–æ—Å–º–æ—Å–µ!",
  "images": [
    "https://generated-image-url.com/cat-in-space.jpg"
  ]
}
```

### –ü—Ä–∏–º–µ—Ä 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

```bash
# –ë—ã—Å—Ç—Ä–∞—è –º–æ–¥–µ–ª—å
curl -X POST http://localhost:8000/ask \
  -d '{"prompt": "–ü—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å", "model": "gemini-2.5-flash"}'

# –£–º–Ω–∞—è –º–æ–¥–µ–ª—å —Å reasoning
curl -X POST http://localhost:8000/ask \
  -d '{"prompt": "–°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞", "model": "gemini-2.5-pro"}'
```

### –ü—Ä–∏–º–µ—Ä 4: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Å–∏

```bash
# –í .env
GEMINI_PROXY=http://user:pass@proxy-ip:port
```

---

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### Hot-reload –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# app.py –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ä–∞–∑—É
docker-compose up
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 -f
```

### –ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–∑–∞

```bash
docker-compose build --no-cache
docker-compose up
```

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "GEMINI_PSID –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `.env` —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `GEMINI_PSID` –∑–∞–ø–æ–ª–Ω–µ–Ω
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker-compose restart`

### –ü—Ä–æ–±–ª–µ–º–∞: "Failed to initialize client"

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ò—Å—Ç—ë–∫ `__Secure-1PSIDTS` ‚Üí –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞
- –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç cookies ‚Üí –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤/–ø–µ—Ä–µ–Ω–æ—Å–æ–≤
- –ê–∫–∫–∞—É–Ω—Ç —Ç—Ä–µ–±—É–µ—Ç 2FA ‚Üí –∑–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å–Ω–æ–≤–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
rm -rf ./cookies/*

# –û–±–Ω–æ–≤–∏—Ç–µ cookies –≤ .env
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose up --force-recreate
```

### –ü—Ä–æ–±–ª–µ–º–∞: Health check failed

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs gemini-api

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MODE=api –≤ .env
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose restart
```

### –ü—Ä–æ–±–ª–µ–º–∞: Rate limit exceeded

**–ü—Ä–∏—á–∏–Ω–∞:** Google –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç ~60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–∫—Å–∏ (`GEMINI_PROXY`)
- –î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (—Å–º. –ø–ª–∞–Ω multi-account)

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã

```bash
docker stats gemini-api
```

### Health check

```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (Docker)
docker inspect gemini-api | grep Health

# –†—É—á–Ω–æ–π (API —Ä–µ–∂–∏–º)
curl http://localhost:8000/health
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env`** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
2. **Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç `appuser`
3. **Secrets management** ‚Äî –¥–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Secrets –∏–ª–∏ Vault
4. **Network isolation** ‚Äî –≤ docker-compose –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å internal network

**–ü—Ä–∏–º–µ—Ä —Å Docker Secrets:**
```yaml
services:
  gemini-api:
    secrets:
      - gemini_psid
      - gemini_psidts

secrets:
  gemini_psid:
    file: ./secrets/psid.txt
  gemini_psidts:
    file: ./secrets/psidts.txt
```

---

## üì¶ Production Deployment

### Docker Swarm

```bash
docker stack deploy -c docker-compose.yml gemini-api
```

### Kubernetes

```bash
# –°–æ–∑–¥–∞–π—Ç–µ Secret
kubectl create secret generic gemini-credentials \
  --from-literal=GEMINI_PSID=your_psid \
  --from-literal=GEMINI_PSIDTS=your_psidts

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ Deployment
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **Multi-account pool** ‚Äî –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 100+ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (—Å–º. `implementation_plan.md`)
2. **PostgreSQL integration** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ cookies –≤ –ë–î
3. **Prometheus metrics** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **Rate limiting** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ Google

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Issues:** [GitHub Issues](https://github.com/HanaokaYuzu/Gemini-API/issues)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:** [README.md](README.md)

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

GPL-3.0 (—Å–º. [LICENSE](LICENSE))
